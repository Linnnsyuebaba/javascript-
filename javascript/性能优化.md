# 性能

> ### 减少请求的次数 

- 合并
    通过对js，css文件的压缩合并有效地减少文件的体积，减少文件数量，从而有效的减少请求次数
- 图片处理
    将图片的内容以Base64格式内嵌到HTML中，可以减少HTTP请求数量。但是，由于Base64编码用8位字符表示信息中的6个位，所以编码后大小大约比原始值扩大了33%
    并使用字体图标来代替小图

> ### 使用缓存

缓存会根据请求保存并输出内容的副本，eg：图片，脚本等，当下一个请求来到的时候，且是相同的URL，缓存直接使用本地的副本响应，而不是再次向服务器发起请求，从而减少网络带宽的消耗，降低请求响应时间。  
这里拉取两张图来说明请求过程。

![](https://user-gold-cdn.xitu.io/2018/5/28/163a30da286b56f5?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

<center>第一次请求</center>

![](https://user-gold-cdn.xitu.io/2018/5/28/163a30d9a369b2a6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

<center>再次请求</center>  



> ### 减少重定向

尽量避免使用重定向，当页面发生了重定向，就会延迟整个HTML文档的传输。在HTML文档到达之前，页面中不会呈现任何东西，也没有任何组件会被下载，降低了用户体验  

如果一定要使用重定向，如http重定向到https，要使用301永久重定向，而不是302临时重定向。因为，如果使用302，则每一次访问http，都会被重定向到https的页面。而永久重定向，在第一次从http重定向到https之后 ，每次访问http，会直接返回https的页面

    还要避免空的src、href、method

> ### 优化网络连接

- 使用CDN (Content Delivery Network)
- DNS预解析  
    由于HTML的解析是自上而下，顺序读取，所以可以在head中提前添加可能会解析到的域名，使解析结果缓存到系统缓存中，缩短DNS解析时间，来提高网站的访问速度
    ```javascript
    <link rel="dns-prefecth" href="https://www.google.com">
    ```
- 持久连接(keep-alive)  
    正常的http请求都是打开一个TCP连接，使用一次打开完成后关闭。若使用keep-alive来建立持久连接，可以降低时延和开销，保持连接的持续性。  
    但是，keep-alive也有弊端,长时间的TCP连接容易导致系统资源无效占用。配置不当的keep-alive，有时比重复利用连接带来的损失还更大。所以，正确地设置keep-alive的超时时间非常重要。

> ### 资源加载
- 懒加载  
    延迟加载资源或符合某些条件时才加载某些资源
- 预加载  
    提前加载用户需要的资源，提升用户体验
- 按需加载
    一般通过路由来决定加载的模块，例如vue-router，并通过keep-alive来实现切换不再刷新请求  
    按需加载，是一种很好的优化网页或应用的方式。这种方式实际上是先把代码在一些逻辑断点处分离开，然后在一些代码块中完成某些操作后，立即引用或即将引用另外一些新的代码块。

> ### 减少重绘
- CSS  
    1.避免层级较深的选择器  
    2.img先设置好宽高  
    3.减少table布局  
    4.尽量减少由js实现的样式
- DOM  
    1.减少DOM操作  
    2.使用事件代理  
    3.及时清理环境，回收内存
